import pymongo

mongoClient = pymongo.MongoClient("mongodb://192.168.47.189:27017/")
mongoDb = mongoClient["droidDet"]
apksListCollection = mongoDb["apkList"]

apksList = list(apksListCollection.find({}))

total_duplication = 0
for index, apk in enumerate(apksList):
    similar_apks = apksListCollection.find({"pkg_name": apk["pkg_name"]})

    if similar_apks.count() > 1:
        total_duplication += 1
        print(f"index:{index} - total:{total_duplication} - pkg_name: {apk['pkg_name']} - file_name: {apk['file_name']}")
        del apksList[apksList.index(apk)]

        for sim_count,  sim_apk in enumerate(similar_apks):
            if sim_count < 1:
                continue

            apksListCollection.remove({"file_name": apk["file_name"]})

print(f"total: {total_duplication}")
